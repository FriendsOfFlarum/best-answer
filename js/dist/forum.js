(()=>{var t={n:s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return t.d(e,{a:e}),e},d:(s,e)=>{for(var n in e)t.o(e,n)&&!t.o(s,n)&&Object.defineProperty(s,n,{enumerable:!0,get:e[n]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s),t.d(s,{components:()=>ot});const e=flarum.core.compat["forum/app"];var n=t.n(e);const o=flarum.core.compat["common/extend"],r=flarum.core.compat["common/models/Discussion"];var a=t.n(r);const i=flarum.core.compat["tags/models/Tag"];var c=t.n(i);const u=flarum.core.compat["common/Model"];var f=t.n(u);const l=flarum.core.compat["forum/components/IndexPage"];var p=t.n(l);const d=flarum.core.compat["common/components/Dropdown"];var b=t.n(d);const w=flarum.core.compat["common/components/Button"];var h=t.n(w);const A=flarum.core.compat["forum/states/DiscussionListState"];var v=t.n(A);const y=flarum.core.compat["forum/components/DiscussionComposer"];var P=t.n(y);function _(t,s){return _=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t},_(t,s)}function B(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,_(t,s)}const g=flarum.core.compat["forum/components/Notification"];var k=t.n(g),x=function(t){function s(){return t.apply(this,arguments)||this}B(s,t);var e=s.prototype;return e.icon=function(){return"fas fa-comment-dots"},e.href=function(){var t=this.attrs.notification.subject();return n().route.discussion(t)},e.content=function(){return n().translator.trans("fof-best-answer.forum.notification.content")},e.excerpt=function(){return null},s}(k());const S=flarum.core.compat["forum/utils/PostControls"];var N=t.n(S);const O=flarum.core.compat["forum/components/DiscussionPage"];var I=t.n(O);const T=flarum.core.compat["forum/components/CommentPost"];var U=t.n(T);const j=flarum.core.compat["forum/components/Post"];var D=t.n(j);const C=flarum.core.compat["forum/components/PostMeta"];var Q=t.n(C);const H=flarum.core.compat["common/helpers/username"];var q=t.n(H);const M=flarum.core.compat["common/helpers/userOnline"];var L=t.n(M);const z=flarum.core.compat["common/components/Link"];var F=t.n(z);const G=flarum.core.compat["common/Component"];var E=t.n(G);const J=flarum.core.compat["common/helpers/icon"];var K=t.n(J);const R=flarum.core.compat["common/helpers/humanTime"];var V=t.n(R);const W=flarum.core.compat["common/utils/ItemList"];var X=t.n(W),Y=function(t){function s(){return t.apply(this,arguments)||this}B(s,t);var e=s.prototype;return e.oninit=function(s){t.prototype.oninit.call(this,s);var e=this.attrs,n=e.post,o=e.discussion;this.post=n,this.discussion=o},e.view=function(){return m("li",{className:"Post--BestAnswer"},this.items().toArray())},e.getSetTime=function(t){if(null!==t.bestAnswerSetAt())return V()(t.bestAnswerSetAt())},e.items=function(){var t=this,s=new(X());return s.add("post",this.post?m("span",null,K()("fas fa-check"),n().translator.trans("fof-best-answer.forum.best_answer_button")):m(F(),{href:n().route.post(this.post),"data-number":this.post.number()},K()("fas fa-check"),n().translator.trans("fof-best-answer.forum.best_answer_button"))),s.add("user",m("span",{className:"BestAnswer--User"},n().translator.trans("fof-best-answer.forum.best_answer_label",{user:this.discussion.bestAnswerUser(),time_set:this.getSetTime(this.discussion),a:m("a",{onclick:function(){return m.route.set(n().route.user(t.discussion.bestAnswerUser()))}})}))),s},s}(E());const Z=flarum.core.compat["common/components/Badge"];var $=t.n(Z),tt=function(t){function s(){return t.apply(this,arguments)||this}B(s,t);var e=s.prototype;return e.icon=function(){return"fas fa-check"},e.href=function(){var t=this.attrs.notification.subject();return n().route.discussion(t)},e.content=function(){var t=this.attrs.notification.fromUser();return n().translator.trans("fof-best-answer.forum.notification.awarded",{user:t})},e.excerpt=function(){return null},s}(k()),st=function(t){function s(){return t.apply(this,arguments)||this}B(s,t);var e=s.prototype;return e.icon=function(){return"fas fa-check"},e.href=function(){var t=this.attrs.notification.subject();return n().route.discussion(t)},e.content=function(){var t=this.attrs.notification.fromUser();return n().translator.trans("fof-best-answer.forum.notification.best_answer_in_discussion",{user:t})},e.excerpt=function(){return null},s}(k());const et=flarum.core.compat["forum/components/NotificationGrid"];var nt=t.n(et),ot={SelectBestAnswerItem:Y};n().initializers.add("fof/best-answer",(function(){var t,s,e,r,i;a().prototype.bestAnswerPost=f().hasOne("bestAnswerPost"),a().prototype.bestAnswerUser=f().hasOne("bestAnswerUser"),a().prototype.hasBestAnswer=f().attribute("hasBestAnswer"),a().prototype.canSelectBestAnswer=f().attribute("canSelectBestAnswer"),a().prototype.bestAnswerSetAt=f().attribute("bestAnswerSetAt",f().transformDate),n().initializers.has("flarum-tags")&&(c().prototype.isQnA=f().attribute("isQnA")),n().notificationComponents.selectBestAnswer=x,n().notificationComponents.awardedBestAnswer=tt,n().notificationComponents.bestAnswerInDiscussion=st,(0,o.extend)(a().prototype,"badges",(function(t){this.hasBestAnswer()&&!t.has("hidden")&&t.add("bestAnswer",m($(),{type:"bestAnswer",icon:"fas fa-check",label:n().translator.trans("fof-best-answer.forum.answered_badge")}))})),t=function(t,s){return s.isHidden()||1===s.number()||!t.canSelectBestAnswer()||!n().session.user},s=function(t){return!n().forum.attribute("canSelectBestAnswerOwnPost")&&t.user()&&t.user().id()===n().session.user.id()},e=function(t,s){return t.bestAnswerPost()&&t.bestAnswerPost().id()===s.id()},r=function(t){return n().translator.trans(t?"fof-best-answer.forum.remove_best_answer":"fof-best-answer.forum.this_best_answer")},i=function(t,s,e){t.save({bestAnswerPostId:s?e.id():0,bestAnswerUserId:n().session.user.id(),relationships:s?{bestAnswerPost:e,bestAnswerUser:n().session.user}:delete t.data.relationships.bestAnswerPost}).then((function(){n().current.matches(I())&&n().current.get("stream").update(),m.redraw(),s&&m.route.set(n().route.discussion(t))}))},(0,o.extend)(N(),"moderationControls",(function(o,a){if(!n().forum.attribute("useAlternativeBestAnswerUi")){var c=a.discussion(),u=e(c,a);a.pushAttributes({isBestAnswer:u}),"comment"===a.contentType()&&(t(c,a)||s(a)||!n().current.matches(I())||o.add("bestAnswer",h().component({icon:"fa"+(u?"s":"r")+" fa-comment-dots",onclick:function(){i(c,u=!u,a)}},r(u))))}})),(0,o.extend)(U().prototype,"actionItems",(function(o){if(n().forum.attribute("useAlternativeBestAnswerUi")){var a=this.attrs.post,c=this.attrs.post.discussion(),u=e(c,a),m=!1!==c.bestAnswerPost();a.pushAttributes({isBestAnswer:u}),t(c,a)||s(a)||!n().current.matches(I())||o.add("bestAnswer",h().component({className:m?u?"Button Button--primary":"Button Button--link":"Button Button--primary",onclick:function(){m=!m,i(c,u=!u,a)}},r(u)))}})),(0,o.extend)(U().prototype,"headerItems",(function(t){var s=this.attrs.post;s.discussion().bestAnswerPost()&&s.discussion().bestAnswerPost().id()===s.id()&&!s.isHidden()&&t.add("isBestAnswer",Y.component({post:s,discussion:s.discussion()}))})),(0,o.extend)(U().prototype,"footerItems",(function(t){var s=this.attrs.post,e=s.discussion(),n=e.bestAnswerPost();if(n&&!n.isHidden()&&1===s.number()&&!s.isHidden()){var o=n.user();t.add("bestAnswerPost",m("div",{className:"CommentPost",onclick:function(){return app.current.get("stream").goToNumber(n.number())}},m("div",{className:"Post-header"},m("ul",null,m("li",{className:"item-user"},m("div",{className:"PostUser"},o&&L()(o),m("h3",null,o?m(F(),{href:app.route.user(o)},q()(o)):q()(o)))),n.discussion()&&m("li",{className:"item-meta"},Q().component({post:n})),Y.component({post:n,discussion:e}))),m("div",{className:"Post-body"},m.trust(n.contentHtml()))),-10)}})),(0,o.extend)(D().prototype,"elementAttrs",(function(t){var s=this.attrs.post;s.discussion().bestAnswerPost()&&s.discussion().bestAnswerPost().id()===s.id()&&!s.isHidden()&&(t.className?t.className+=" Post--bestAnswer":t.className="Post--bestAnswer")})),(0,o.extend)(nt().prototype,"notificationTypes",(function(t){t.add("awardedBestAnswer",{name:"awardedBestAnswer",icon:"fas fa-check",label:n().translator.trans("fof-best-answer.forum.notification.preferences.awarded_best_answer")}),t.add("bestAnswerInDiscussion",{name:"bestAnswerInDiscussion",icon:"fas fa-check",label:n().translator.trans("fof-best-answer.forum.notification.preferences.best_answer_in_discussion")}),t.add("selectBestAnswer",{name:"selectBestAnswer",icon:"fas fa-stopwatch",label:n().translator.trans("fof-best-answer.forum.notification.preferences.select_best_answer")})})),(0,o.extend)(p().prototype,"sidebarItems",(function(t){var s=this.currentTag();if(null!=s&&null!=s.isQnA&&s.isQnA()){var e=n().forum.attribute("canStartDiscussion")||!n().session.user,o=t.get("newDiscussion");o.children=n().translator.trans(e?"fof-best-answer.forum.index.ask_question":"fof-best-answer.forum.index.cannot_ask_question"),t.replace("startDiscussion",o)}})),(0,o.extend)(p().prototype,"viewItems",(function(t){if(n().forum.attribute("showBestAnswerFilterUi")){var s=this.currentTag();if(null!=s&&null!=s.isQnA&&s.isQnA()){var e=["all","solved","unsolved"],o=n().discussions.bestAnswer;t.add("solved-filter",b().component({buttonClassName:"Button",label:n().translator.trans("fof-best-answer.forum.filter."+(e[o]||Object.keys(e).map((function(t){return e[t]}))[0])+"_label"),accessibleToggleLabel:n().translator.trans("fof-best-answer.forum.filter.accessible_label")},Object.keys(e).map((function(t){var s=e[t],r=(o||Object.keys(e)[0])===t;return h().component({icon:!r||"fas fa-check",active:r,onclick:function(){n().discussions.bestAnswer=t,"0"===t&&delete n().discussions.bestAnswer,n().discussions.refresh()}},n().translator.trans("fof-best-answer.forum.filter."+s+"_label"))}))))}else n().discussions.bestAnswer&&(delete n().discussions.bestAnswer,n().discussions.refresh())}})),(0,o.extend)(v().prototype,"requestParams",(function(t){if(n().discussions.bestAnswer){var s="2"===n().discussions.bestAnswer?"-":"";t.filter[s+"solved-discussions"]=!0,t.filter.q&&(t.filter.q+=" "+s+"is:solved")}})),(0,o.extend)(P().prototype,"headerItems",(function(t){var s=this.composer.fields.tags;void 0!==s&&s.some((function(t){return t.isQnA()}))&&(this.attrs.titlePlaceholder=n().translator.trans("fof-best-answer.forum.composer.titlePlaceholder"),t.replace("discussionTitle",m("h3",null,m("input",{className:"FormControl",bidi:this.title,placeholder:this.attrs.titlePlaceholder,disabled:!!this.attrs.disabled,onkeydown:this.onkeydown.bind(this)}))))}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map