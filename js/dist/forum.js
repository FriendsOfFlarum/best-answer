(()=>{var t={472:t=>{"use strict";t.exports=flarum.extensions["fof-user-directory"]}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,s),o.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";s.r(n),s.d(n,{components:()=>lt});const t=flarum.core.compat["forum/app"];var e=s.n(t);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["common/models/Discussion"];var a=s.n(o);const i=flarum.core.compat["tags/models/Tag"];var c=s.n(i);const u=flarum.core.compat["common/Model"];var f=s.n(u);const l=flarum.core.compat["forum/components/IndexPage"];var p=s.n(l);const d=flarum.core.compat["common/components/Dropdown"];var b=s.n(d);const w=flarum.core.compat["common/components/Button"];var h=s.n(w);const v=flarum.core.compat["forum/states/DiscussionListState"];var A=s.n(v);const y=flarum.core.compat["forum/components/DiscussionComposer"];var _=s.n(y);function P(t,e){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},P(t,e)}function g(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,P(t,e)}const B=flarum.core.compat["forum/components/Notification"];var x=s.n(B),S=function(t){function s(){return t.apply(this,arguments)||this}g(s,t);var n=s.prototype;return n.icon=function(){return"fas fa-comment-dots"},n.href=function(){var t=this.attrs.notification.subject();return e().route.discussion(t)},n.content=function(){return e().translator.trans("fof-best-answer.forum.notification.content")},n.excerpt=function(){return null},s}(x());const k=flarum.core.compat["forum/utils/PostControls"];var O=s.n(k);const C=flarum.core.compat["forum/components/DiscussionPage"];var j=s.n(C);const I=flarum.core.compat["forum/components/CommentPost"];var N=s.n(I);function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}const T=flarum.core.compat["forum/components/Post"];var D=s.n(T);const M=flarum.core.compat["forum/components/PostMeta"];var Q=s.n(M);const H=flarum.core.compat["common/helpers/username"];var q=s.n(H);const L=flarum.core.compat["common/helpers/userOnline"];var z=s.n(L);const F=flarum.core.compat["common/components/Link"];var E=s.n(F);const G=flarum.core.compat["common/utils/classList"];var $=s.n(G);const J=flarum.core.compat["common/Component"];var K=s.n(J);const R=flarum.core.compat["common/helpers/icon"];var V=s.n(R);const W=flarum.core.compat["common/helpers/humanTime"];var X=s.n(W);const Y=flarum.core.compat["common/utils/ItemList"];var Z=s.n(Y),tt=function(t){function s(){return t.apply(this,arguments)||this}g(s,t);var n=s.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e);var s=this.attrs,n=s.post,r=s.discussion;this.post=n,this.discussion=r},n.view=function(){return m("li",{className:"Post--BestAnswer"},this.items().toArray())},n.getSetTime=function(t){if(null!==t.bestAnswerSetAt())return X()(t.bestAnswerSetAt())},n.items=function(){var t=this,s=new(Z());return s.add("post",this.post?m("span",null,V()("fas fa-check"),e().translator.trans("fof-best-answer.forum.best_answer_button")):m(E(),{href:e().route.post(this.post),"data-number":this.post.number()},V()("fas fa-check"),e().translator.trans("fof-best-answer.forum.best_answer_button"))),s.add("user",m("span",{className:"BestAnswer--User"},e().translator.trans("fof-best-answer.forum.best_answer_label",{user:this.discussion.bestAnswerUser(),time_set:this.getSetTime(this.discussion),a:m("a",{onclick:function(){return m.route.set(e().route.user(t.discussion.bestAnswerUser()))}})}))),s},s}(K());const et=flarum.core.compat["common/components/Badge"];var st=s.n(et),nt=function(t){function s(){return t.apply(this,arguments)||this}g(s,t);var n=s.prototype;return n.icon=function(){return"fas fa-check"},n.href=function(){var t=this.attrs.notification.subject();return e().route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return e().translator.trans("fof-best-answer.forum.notification.awarded",{user:t})},n.excerpt=function(){return null},s}(x()),rt=function(t){function s(){return t.apply(this,arguments)||this}g(s,t);var n=s.prototype;return n.icon=function(){return"fas fa-check"},n.href=function(){var t=this.attrs.notification.subject();return e().route.discussion(t)},n.content=function(){var t=this.attrs.notification.fromUser();return e().translator.trans("fof-best-answer.forum.notification.best_answer_in_discussion",{user:t})},n.excerpt=function(){return null},s}(x());const ot=flarum.core.compat["forum/components/NotificationGrid"];var at=s.n(ot);const it=flarum.core.compat["common/models/User"];var ct=s.n(it);const ut=flarum.core.compat["forum/components/UserCard"];var ft=s.n(ut);function mt(){return mt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},mt.apply(this,arguments)}var lt={SelectBestAnswerItem:tt};e().initializers.add("fof/best-answer",(function(){var t,n,o,i,u,l,d;a().prototype.bestAnswerPost=f().hasOne("bestAnswerPost"),a().prototype.bestAnswerUser=f().hasOne("bestAnswerUser"),a().prototype.hasBestAnswer=f().attribute("hasBestAnswer"),a().prototype.canSelectBestAnswer=f().attribute("canSelectBestAnswer"),a().prototype.bestAnswerSetAt=f().attribute("bestAnswerSetAt",f().transformDate),e().initializers.has("flarum-tags")&&(c().prototype.isQnA=f().attribute("isQnA")),e().notificationComponents.selectBestAnswer=S,e().notificationComponents.awardedBestAnswer=nt,e().notificationComponents.bestAnswerInDiscussion=rt,(0,r.extend)(a().prototype,"badges",(function(t){this.hasBestAnswer()&&!t.has("hidden")&&t.add("bestAnswer",m(st(),{type:"bestAnswer",icon:"fas fa-check",label:e().translator.trans("fof-best-answer.forum.answered_badge")}))})),t=function(t,s){return s.isHidden()||1===s.number()||!t.canSelectBestAnswer()||!e().session.user},n=function(t){return!e().forum.attribute("canSelectBestAnswerOwnPost")&&t.user()&&t.user().id()===e().session.user.id()},o=function(t,e){return t.bestAnswerPost()&&t.bestAnswerPost().id()===e.id()},i=function(t){return e().translator.trans(t?"fof-best-answer.forum.remove_best_answer":"fof-best-answer.forum.this_best_answer")},u=function(){var t=e().forum.attribute("fof-best-answer.tags")||[];return e().store.all("tags").filter((function(e){return t.includes(e.id())}))},l=function(t,s,n){t.save({bestAnswerPostId:s?n.id():0,bestAnswerUserId:e().session.user.id(),relationships:s?{bestAnswerPost:n,bestAnswerUser:e().session.user}:delete t.data.relationships.bestAnswerPost}).then((function(){var n,r=(null==(n=t.data.relationships.tags)?void 0:n.data)||[];if(s)r.push.apply(r,u().map((function(t){return{type:"tags",id:t.id()}})));else for(var o,a=function(){var t=o.value,e=r.findIndex((function(e){return e.id===t.id()}));e>-1&&r.splice(e,1)},i=function(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=function(t,e){if(t){if("string"==typeof t)return U(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?U(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(u());!(o=i()).done;)a();e().current.matches(j())&&e().current.get("stream").update(),m.redraw(),s&&m.route.set(e().route.discussion(t))}))},(0,r.extend)(O(),"moderationControls",(function(s,r){if(!e().forum.attribute("useAlternativeBestAnswerUi")){var a=r.discussion(),c=o(a,r);r.pushAttributes({isBestAnswer:c}),"comment"===r.contentType()&&(t(a,r)||n(r)||!e().current.matches(j())||s.add("bestAnswer",h().component({icon:"fa"+(c?"s":"r")+" fa-comment-dots",onclick:function(){l(a,c=!c,r)}},i(c))))}})),(0,r.extend)(N().prototype,"actionItems",(function(s){if(e().forum.attribute("useAlternativeBestAnswerUi")){var r=this.attrs.post,a=this.attrs.post.discussion(),c=o(a,r),u=!1!==a.bestAnswerPost();r.pushAttributes({isBestAnswer:c}),t(a,r)||n(r)||!e().current.matches(j())||s.add("bestAnswer",h().component({className:u?c?"Button Button--primary":"Button Button--link":"Button Button--primary",onclick:function(){u=!u,l(a,c=!c,r)}},i(c)))}})),(0,r.extend)(N().prototype,"headerItems",(function(t){var e=this.attrs.post;e.discussion().bestAnswerPost()&&e.discussion().bestAnswerPost().id()===e.id()&&!e.isHidden()&&t.add("isBestAnswer",tt.component({post:e,discussion:e.discussion()}))})),(0,r.extend)(N().prototype,"footerItems",(function(t){var s=this.attrs.post,n=s.discussion(),r=n.bestAnswerPost(),o=e().forum.attribute("fof-best-answer.show_max_lines");if(r&&!r.isHidden()&&1===s.number()&&!s.isHidden()){var a=r.user();t.add("bestAnswerPost",m("div",{className:"CommentPost",onclick:function(){return e().current.get("stream").goToNumber(r.number())}},m("div",{className:"Post-header"},m("ul",null,m("li",{className:"item-user"},m("div",{className:"PostUser"},a&&z()(a),m("h3",null,a?m(E(),{href:e().route.user(a)},q()(a)):q()(a)))),r.discussion()&&m("li",{className:"item-meta"},Q().component({post:r})),tt.component({post:r,discussion:n}))),m("div",{className:$()("Post-body",o>0&&"Post-body--truncate"),style:{"--max-lines":o}},m.trust(r.contentHtml()))),-10)}})),(0,r.extend)(D().prototype,"elementAttrs",(function(t){var e=this.attrs.post;e.discussion().bestAnswerPost()&&e.discussion().bestAnswerPost().id()===e.id()&&!e.isHidden()&&(t.className?t.className+=" Post--bestAnswer":t.className="Post--bestAnswer")})),ct().prototype.bestAnswerCount=f().attribute("bestAnswerCount"),(0,r.extend)(ft().prototype,"infoItems",(function(t){var s=this.attrs.user;t.add("best-answer-count",m("span",{className:"UserCard-bestAnswerCount"},V()("fas fa-check"),e().translator.trans("fof-best-answer.forum.user.best-answer-count",{count:s.bestAnswerCount()})),55)})),(d=s(472))&&(0,r.override)(d.SortMap.prototype,"sortMap",(function(t){return mt({},t(),{most_best_answers:"-bestAnswerCount",least_best_answers:"bestAnswerCount"})})),(0,r.extend)(at().prototype,"notificationTypes",(function(t){t.add("awardedBestAnswer",{name:"awardedBestAnswer",icon:"fas fa-check",label:e().translator.trans("fof-best-answer.forum.notification.preferences.awarded_best_answer")}),t.add("bestAnswerInDiscussion",{name:"bestAnswerInDiscussion",icon:"fas fa-check",label:e().translator.trans("fof-best-answer.forum.notification.preferences.best_answer_in_discussion")}),t.add("selectBestAnswer",{name:"selectBestAnswer",icon:"fas fa-stopwatch",label:e().translator.trans("fof-best-answer.forum.notification.preferences.select_best_answer")})})),(0,r.extend)(p().prototype,"sidebarItems",(function(t){var s=this.currentTag();if(null!=s&&null!=s.isQnA&&s.isQnA()){var n=e().forum.attribute("canStartDiscussion")||!e().session.user,r=t.get("newDiscussion");r.children=e().translator.trans(n?"fof-best-answer.forum.index.ask_question":"fof-best-answer.forum.index.cannot_ask_question"),t.replace("startDiscussion",r)}})),(0,r.extend)(p().prototype,"viewItems",(function(t){if(e().forum.attribute("showBestAnswerFilterUi")){var s=this.currentTag();if(null!=s&&null!=s.isQnA&&s.isQnA()){var n=["all","solved","unsolved"],r=e().discussions.bestAnswer;t.add("solved-filter",b().component({buttonClassName:"Button",label:e().translator.trans("fof-best-answer.forum.filter."+(n[r]||Object.keys(n).map((function(t){return n[t]}))[0])+"_label"),accessibleToggleLabel:e().translator.trans("fof-best-answer.forum.filter.accessible_label")},Object.keys(n).map((function(t){var s=n[t],o=(r||Object.keys(n)[0])===t;return h().component({icon:!o||"fas fa-check",active:o,onclick:function(){e().discussions.bestAnswer=t,"0"===t&&delete e().discussions.bestAnswer,e().discussions.refresh()}},e().translator.trans("fof-best-answer.forum.filter."+s+"_label"))}))))}else e().discussions.bestAnswer&&(delete e().discussions.bestAnswer,e().discussions.refresh())}})),(0,r.extend)(A().prototype,"requestParams",(function(t){if(e().discussions.bestAnswer){var s="2"===e().discussions.bestAnswer?"-":"";t.filter[s+"solved-discussions"]=!0,t.filter.q&&(t.filter.q+=" "+s+"is:solved")}})),(0,r.extend)(_().prototype,"headerItems",(function(t){var s=this.composer.fields.tags;void 0!==s&&s.some((function(t){return t.isQnA()}))&&(this.attrs.titlePlaceholder=e().translator.trans("fof-best-answer.forum.composer.titlePlaceholder"),t.replace("discussionTitle",m("h3",null,m("input",{className:"FormControl",bidi:this.title,placeholder:this.attrs.titlePlaceholder,disabled:!!this.attrs.disabled,onkeydown:this.onkeydown.bind(this)}))))}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map