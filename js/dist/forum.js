(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>ft});const s=flarum.core.compat["forum/app"];var n=t.n(s);const r=flarum.core.compat["common/extend"],o=flarum.core.compat["common/models/Discussion"];var a=t.n(o);const i=flarum.core.compat["tags/models/Tag"];var c=t.n(i);const u=flarum.core.compat["common/Model"];var f=t.n(u);const l=flarum.core.compat["forum/components/IndexPage"];var d=t.n(l);const p=flarum.core.compat["common/components/Dropdown"];var b=t.n(p);const w=flarum.core.compat["common/components/Button"];var h=t.n(w);const v=flarum.core.compat["forum/states/DiscussionListState"];var A=t.n(v);const y=flarum.core.compat["forum/components/DiscussionComposer"];var P=t.n(y);function _(t,e){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_(t,e)}function g(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_(t,e)}const B=flarum.core.compat["forum/components/Notification"];var x=t.n(B),k=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var s=e.prototype;return s.icon=function(){return"fas fa-comment-dots"},s.href=function(){var t=this.attrs.notification.subject();return n().route.discussion(t)},s.content=function(){return n().translator.trans("fof-best-answer.forum.notification.content")},s.excerpt=function(){return null},e}(x());const S=flarum.core.compat["forum/utils/PostControls"];var I=t.n(S);const O=flarum.core.compat["forum/components/DiscussionPage"];var C=t.n(O);const N=flarum.core.compat["forum/components/CommentPost"];var U=t.n(N);function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}const T=flarum.core.compat["forum/components/Post"];var D=t.n(T);const Q=flarum.core.compat["forum/components/PostMeta"];var H=t.n(Q);const M=flarum.core.compat["common/helpers/username"];var q=t.n(M);const L=flarum.core.compat["common/helpers/userOnline"];var z=t.n(L);const F=flarum.core.compat["common/components/Link"];var E=t.n(F);const G=flarum.core.compat["common/utils/classList"];var $=t.n(G);const J=flarum.core.compat["common/Component"];var K=t.n(J);const R=flarum.core.compat["common/helpers/icon"];var V=t.n(R);const W=flarum.core.compat["common/helpers/humanTime"];var X=t.n(W);const Y=flarum.core.compat["common/utils/ItemList"];var Z=t.n(Y),tt=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e);var s=this.attrs,n=s.post,r=s.discussion;this.post=n,this.discussion=r},s.view=function(){return m("li",{className:"Post--BestAnswer"},this.items().toArray())},s.getSetTime=function(t){if(null!==t.bestAnswerSetAt())return X()(t.bestAnswerSetAt())},s.items=function(){var t=this,e=new(Z());return e.add("post",this.post?m("span",null,V()("fas fa-check"),n().translator.trans("fof-best-answer.forum.best_answer_button")):m(E(),{href:n().route.post(this.post),"data-number":this.post.number()},V()("fas fa-check"),n().translator.trans("fof-best-answer.forum.best_answer_button"))),e.add("user",m("span",{className:"BestAnswer--User"},n().translator.trans("fof-best-answer.forum.best_answer_label",{user:this.discussion.bestAnswerUser(),time_set:this.getSetTime(this.discussion),a:m("a",{onclick:function(){return m.route.set(n().route.user(t.discussion.bestAnswerUser()))}})}))),e},e}(K());const et=flarum.core.compat["common/components/Badge"];var st=t.n(et),nt=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var s=e.prototype;return s.icon=function(){return"fas fa-check"},s.href=function(){var t=this.attrs.notification.subject();return n().route.discussion(t)},s.content=function(){var t=this.attrs.notification.fromUser();return n().translator.trans("fof-best-answer.forum.notification.awarded",{user:t})},s.excerpt=function(){return null},e}(x()),rt=function(t){function e(){return t.apply(this,arguments)||this}g(e,t);var s=e.prototype;return s.icon=function(){return"fas fa-check"},s.href=function(){var t=this.attrs.notification.subject();return n().route.discussion(t)},s.content=function(){var t=this.attrs.notification.fromUser();return n().translator.trans("fof-best-answer.forum.notification.best_answer_in_discussion",{user:t})},s.excerpt=function(){return null},e}(x());const ot=flarum.core.compat["forum/components/NotificationGrid"];var at=t.n(ot);const it=flarum.core.compat["common/models/User"];var ct=t.n(it);const ut=flarum.core.compat["forum/components/UserCard"];var mt=t.n(ut),ft={SelectBestAnswerItem:tt};n().initializers.add("fof/best-answer",(function(){var t,e,s,o,i,u;a().prototype.bestAnswerPost=f().hasOne("bestAnswerPost"),a().prototype.bestAnswerUser=f().hasOne("bestAnswerUser"),a().prototype.hasBestAnswer=f().attribute("hasBestAnswer"),a().prototype.canSelectBestAnswer=f().attribute("canSelectBestAnswer"),a().prototype.bestAnswerSetAt=f().attribute("bestAnswerSetAt",f().transformDate),n().initializers.has("flarum-tags")&&(c().prototype.isQnA=f().attribute("isQnA")),n().notificationComponents.selectBestAnswer=k,n().notificationComponents.awardedBestAnswer=nt,n().notificationComponents.bestAnswerInDiscussion=rt,(0,r.extend)(a().prototype,"badges",(function(t){this.hasBestAnswer()&&!t.has("hidden")&&t.add("bestAnswer",m(st(),{type:"bestAnswer",icon:"fas fa-check",label:n().translator.trans("fof-best-answer.forum.answered_badge")}))})),t=function(t,e){return e.isHidden()||1===e.number()||!t.canSelectBestAnswer()||!n().session.user},e=function(t){return!n().forum.attribute("canSelectBestAnswerOwnPost")&&t.user()&&t.user().id()===n().session.user.id()},s=function(t,e){return t.bestAnswerPost()&&t.bestAnswerPost().id()===e.id()},o=function(t){return n().translator.trans(t?"fof-best-answer.forum.remove_best_answer":"fof-best-answer.forum.this_best_answer")},i=function(){var t=n().forum.attribute("fof-best-answer.tags")||[];return n().store.all("tags").filter((function(e){return t.includes(e.id())}))},u=function(t,e,s){t.save({bestAnswerPostId:e?s.id():0,bestAnswerUserId:n().session.user.id(),relationships:e?{bestAnswerPost:s,bestAnswerUser:n().session.user}:delete t.data.relationships.bestAnswerPost}).then((function(){var s,r=(null==(s=t.data.relationships.tags)?void 0:s.data)||[];if(e)r.push.apply(r,i().map((function(t){return{type:"tags",id:t.id()}})));else for(var o,a=function(){var t=o.value,e=r.findIndex((function(e){return e.id===t.id()}));e>-1&&r.splice(e,1)},c=function(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(s)return(s=s.call(t)).next.bind(s);if(Array.isArray(t)||(s=function(t,e){if(t){if("string"==typeof t)return j(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?j(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(i());!(o=c()).done;)a();n().current.matches(C())&&n().current.get("stream").update(),m.redraw(),e&&m.route.set(n().route.discussion(t))}))},(0,r.extend)(I(),"moderationControls",(function(r,a){if(!n().forum.attribute("useAlternativeBestAnswerUi")){var i=a.discussion(),c=s(i,a);a.pushAttributes({isBestAnswer:c}),"comment"===a.contentType()&&(t(i,a)||e(a)||!n().current.matches(C())||r.add("bestAnswer",h().component({icon:"fa"+(c?"s":"r")+" fa-comment-dots",onclick:function(){u(i,c=!c,a)}},o(c))))}})),(0,r.extend)(U().prototype,"actionItems",(function(r){if(n().forum.attribute("useAlternativeBestAnswerUi")){var a=this.attrs.post,i=this.attrs.post.discussion(),c=s(i,a),m=!1!==i.bestAnswerPost();a.pushAttributes({isBestAnswer:c}),t(i,a)||e(a)||!n().current.matches(C())||r.add("bestAnswer",h().component({className:m?c?"Button Button--primary":"Button Button--link":"Button Button--primary",onclick:function(){m=!m,u(i,c=!c,a)}},o(c)))}})),(0,r.extend)(U().prototype,"headerItems",(function(t){var e=this.attrs.post;e.discussion().bestAnswerPost()&&e.discussion().bestAnswerPost().id()===e.id()&&!e.isHidden()&&t.add("isBestAnswer",tt.component({post:e,discussion:e.discussion()}))})),(0,r.extend)(U().prototype,"footerItems",(function(t){var e=this.attrs.post,s=e.discussion(),r=s.bestAnswerPost(),o=n().forum.attribute("fof-best-answer.show_max_lines");if(r&&!r.isHidden()&&1===e.number()&&!e.isHidden()){var a=r.user();t.add("bestAnswerPost",m("div",{className:"CommentPost",onclick:function(){return n().current.get("stream").goToNumber(r.number())}},m("div",{className:"Post-header"},m("ul",null,m("li",{className:"item-user"},m("div",{className:"PostUser"},a&&z()(a),m("h3",null,a?m(E(),{href:n().route.user(a)},q()(a)):q()(a)))),r.discussion()&&m("li",{className:"item-meta"},H().component({post:r})),tt.component({post:r,discussion:s}))),m("div",{className:$()("Post-body",o>0&&"Post-body--truncate"),style:{"--max-lines":o}},m.trust(r.contentHtml()))),-10)}})),(0,r.extend)(D().prototype,"elementAttrs",(function(t){var e=this.attrs.post;e.discussion().bestAnswerPost()&&e.discussion().bestAnswerPost().id()===e.id()&&!e.isHidden()&&(t.className?t.className+=" Post--bestAnswer":t.className="Post--bestAnswer")})),ct().prototype.bestAnswerCount=f().attribute("bestAnswerCount"),(0,r.extend)(mt().prototype,"infoItems",(function(t){var e=this.attrs.user;t.add("best-answer-count",m("span",{className:"UserCard-bestAnswerCount"},V()("fas fa-check"),n().translator.trans("fof-best-answer.forum.user.best-answer-count",{count:e.bestAnswerCount()})),55)})),(0,r.extend)(at().prototype,"notificationTypes",(function(t){t.add("awardedBestAnswer",{name:"awardedBestAnswer",icon:"fas fa-check",label:n().translator.trans("fof-best-answer.forum.notification.preferences.awarded_best_answer")}),t.add("bestAnswerInDiscussion",{name:"bestAnswerInDiscussion",icon:"fas fa-check",label:n().translator.trans("fof-best-answer.forum.notification.preferences.best_answer_in_discussion")}),t.add("selectBestAnswer",{name:"selectBestAnswer",icon:"fas fa-stopwatch",label:n().translator.trans("fof-best-answer.forum.notification.preferences.select_best_answer")})})),(0,r.extend)(d().prototype,"sidebarItems",(function(t){var e=this.currentTag();if(null!=e&&null!=e.isQnA&&e.isQnA()){var s=n().forum.attribute("canStartDiscussion")||!n().session.user,r=t.get("newDiscussion");r.children=n().translator.trans(s?"fof-best-answer.forum.index.ask_question":"fof-best-answer.forum.index.cannot_ask_question"),t.replace("startDiscussion",r)}})),(0,r.extend)(d().prototype,"viewItems",(function(t){if(n().forum.attribute("showBestAnswerFilterUi")){var e=this.currentTag();if(null!=e&&null!=e.isQnA&&e.isQnA()){var s=["all","solved","unsolved"],r=n().discussions.bestAnswer;t.add("solved-filter",b().component({buttonClassName:"Button",label:n().translator.trans("fof-best-answer.forum.filter."+(s[r]||Object.keys(s).map((function(t){return s[t]}))[0])+"_label"),accessibleToggleLabel:n().translator.trans("fof-best-answer.forum.filter.accessible_label")},Object.keys(s).map((function(t){var e=s[t],o=(r||Object.keys(s)[0])===t;return h().component({icon:!o||"fas fa-check",active:o,onclick:function(){n().discussions.bestAnswer=t,"0"===t&&delete n().discussions.bestAnswer,n().discussions.refresh()}},n().translator.trans("fof-best-answer.forum.filter."+e+"_label"))}))))}else n().discussions.bestAnswer&&(delete n().discussions.bestAnswer,n().discussions.refresh())}})),(0,r.extend)(A().prototype,"requestParams",(function(t){if(n().discussions.bestAnswer){var e="2"===n().discussions.bestAnswer?"-":"";t.filter[e+"solved-discussions"]=!0,t.filter.q&&(t.filter.q+=" "+e+"is:solved")}})),(0,r.extend)(P().prototype,"headerItems",(function(t){var e=this.composer.fields.tags;void 0!==e&&e.some((function(t){return t.isQnA()}))&&(this.attrs.titlePlaceholder=n().translator.trans("fof-best-answer.forum.composer.titlePlaceholder"),t.replace("discussionTitle",m("h3",null,m("input",{className:"FormControl",bidi:this.title,placeholder:this.attrs.titlePlaceholder,disabled:!!this.attrs.disabled,onkeydown:this.onkeydown.bind(this)}))))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map